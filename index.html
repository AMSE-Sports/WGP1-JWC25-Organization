<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Media Registration • WGP#1</title>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.48.0/dist/umd/supabase.js"></script>
  <script>
    const SUPABASE_URL = 'https://mhecpnqwwxspxfhdvzsc.supabase.co';
    const SUPABASE_ANON_KEY =
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZWNwbnF3d3hzcHhmaGR2enNjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwMDc0MjEsImV4cCI6MjA3ODU4MzQyMX0.ONaEMqU6BHuMSywE3Yvtbj78NqBbecI18amsD18Cgnc';

    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    let mediaUploadState = { path:null, url:null };
  </script>

  <style>
    :root {
      --primary:#f37021;
      --border:#e5e7eb;
      --font-base:clamp(18px, 2vw, 22px);
      --font-label:clamp(17px, 1.8vw, 20px);
      --font-title:clamp(26px, 3vw, 34px);
    }

    * { box-sizing:border-box; }

    body {
      margin:0; padding:0;
      font-family:system-ui, -apple-system, Segoe UI, Roboto, Inter, sans-serif;
      background:#fafafa;
      color:#111;
      font-size:var(--font-base);
    }

    .header img { width:100%; display:block; }

    .card { background:#fff; width:100%; }

    .head {
      padding:20px;
      border-bottom:1px solid var(--border);
    }
    .head h2 { margin:0; font-size:var(--font-title); font-weight:900; }

    .body { padding:20px; }

    label.title {
      font-weight:800;
      font-size:var(--font-label);
      display:block;
      margin-bottom:6px;
    }

    input, select {
      width:100%;
      padding:14px 16px;
      border-radius:12px;
      border:1px solid var(--border);
      font-size:var(--font-base);
      background:#fff;
    }
    input:focus {
      border-color:var(--primary);
      box-shadow:0 0 0 3px rgba(243,112,33,.2);
      outline:none;
    }

    .row { display:grid; gap:16px; margin-bottom:16px; }
    @media(min-width:760px){
      .row.two { grid-template-columns:1fr 1fr; }
    }

    .note { color:#666; font-size:clamp(14px,1.4vw,18px); }

    .section-title {
      margin:10px 0;
      padding:8px 14px;
      background:#fff7f1;
      border:1px solid #ffddc1;
      border-radius:10px;
      color:#b45309;
      font-weight:800;
      font-size:var(--font-label);
    }

    .btn {
      width:100%;
      padding:16px;
      border:0;
      border-radius:14px;
      font-size:var(--font-base);
      font-weight:800;
      cursor:pointer;
      margin-top:10px;
    }
    .btn.primary { background:var(--primary); color:white; }

    .hidden { display:none!important; }
    .footer { padding:20px; text-align:center; color:#666; }

    /* กล่องข้อความ Consent แบบเต็ม */
.consent-box {
  padding: 14px 16px;
  border-radius: 14px;
  background: #fff7f1;
  border: 1px solid #fed7aa;
  font-size: var(--font-base);
  line-height: 1.6;
  color: #444;
}

/* แถว checkbox ให้ตกกับข้อความสวย ๆ */
.consent-check {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  margin-top: 10px;
  font-size: var(--font-base);
}

.consent-check input[type="checkbox"] {
  flex: 0 0 auto;
  width: 1.4em;
  height: 1.4em;
  margin-top: 0.25em;
  accent-color: var(--primary);
}

.consent-check span {
  flex: 1 1 auto;
  line-height: 1.5;
}

    /* THANK YOU PAGE */
    .thankfull {
      min-height:80vh;
      display:flex; align-items:center; justify-content:center;
      flex-direction:column;
      color:white; text-align:center;
      padding:20px;
      background:linear-gradient(135deg,#f37021,#ff8c4a);
    }
    .thankfull h2 { font-size:clamp(34px,4vw,60px); margin-bottom:14px; }
    .thankfull p { max-width:700px; line-height:1.5; font-size:clamp(18px,2vw,24px); }
  </style>
</head>

<body>
  <!-- HEADER -->
  <div class="header"><img src="Header.png"></div>

  <!-- FORM SCREEN -->
  <section id="screen-form" class="card">
    <div class="head">
      <h2>Media Registration</h2>
      <p class="note">ลงทะเบียนสำหรับสื่อมวลชน • Media Accreditation</p>
    </div>

    <form class="body" id="media-form">

      <div class="section-title">A. Personal Info</div>

      <div class="row two">
        <div>
          <label class="title">ชื่อจริง / First Name *</label>
          <input id="first_name" required>
        </div>
        <div>
          <label class="title">นามสกุล / Last Name *</label>
          <input id="last_name" required>
        </div>
      </div>

      <div class="row two">
        <div>
          <label class="title">เบอร์ติดต่อ / Phone *</label>
          <input id="phone" required placeholder="+66 ... / +...">
        </div>
        <div>
          <label class="title">อีเมล / Email *</label>
          <input id="email" type="email" required placeholder="example@email.com">
        </div>
      </div>

      <div class="row">
        <div>
          <label class="title">ชื่อหน่วยงานหรือสำนักข่าว / Media Company *</label>
          <input id="media_company" required placeholder="เช่น Thairath, Workpoint, AP News">
        </div>
      </div>

      <div class="section-title">B. Media Proof (บังคับ)</div>

      <div class="row">
        <div>
          <label class="title">อัปโหลดบัตรสื่อ / Upload Media ID *</label>
          <input type="file" id="media_file" accept="image/*" required>
          <input type="hidden" id="media_url">
          <p id="upload_status" class="note">กรุณาอัปโหลดรูปไฟล์บัตรสื่อ • Required</p>
        </div>
      </div>

     <div class="section-title">C. Consent</div>

<div class="row">
  <div>
    <div class="consent-box">
      <strong>TH: การจัดเก็บและใช้ข้อมูลส่วนบุคคล และการบันทึกภาพ/วิดีโอ</strong>
      <p>
        ข้อมูลที่กรอกในแบบฟอร์มนี้จะถูกใช้เพื่อการจัดการงาน การออกบัตรสื่อ การติดต่อประสานงาน 
        และการดูแลความปลอดภัยภายในงาน WGP#1 Waterjet World Cup 2025 เท่านั้น 
        ข้อมูลจะไม่ถูกนำไปใช้เพื่อวัตถุประสงค์อื่นโดยไม่ได้รับความยินยอมเพิ่มเติม 
        และผู้จัดงานจะดำเนินการเก็บรักษาข้อมูลตามมาตรการความปลอดภัยที่เหมาะสม
      </p>
      <p>
        นอกจากนี้ การเข้าร่วมงานซึ่งมีการถ่ายทอดสดและเผยแพร่สู่สาธารณะทั่วโลก 
        ถือเป็นการยินยอมให้ผู้จัดงานและพันธมิตร สามารถบันทึกภาพนิ่ง วิดีโอ และเสียงของท่าน 
        เพื่อนำไปใช้ในสื่อประชาสัมพันธ์ โฆษณา ถ่ายทอดสด คลิปสรุปงาน และสื่ออื่น ๆ ที่เกี่ยวข้อง 
        โดยไม่ต้องขออนุญาตเป็นรายครั้ง หรือจ่ายค่าตอบแทนใด ๆ เพิ่มเติม
      </p>

      <strong>EN: Personal Data & Media (Photo & Video)</strong>
      <p>
        The information you provide in this form will be used solely for event management, 
        media accreditation, coordination, and safety purposes related to the 
        WGP#1 Waterjet World Cup 2025. It will not be used for other purposes without your further consent, 
        and appropriate security measures will be applied to protect your data.
      </p>
      <p>
        By attending the event, you grant the organizers and their partners full consent to photograph, film, 
        and record your image and voice for broadcasting, promotions, advertising, live streaming, 
        highlight clips, and other related media, without the need for additional permission 
        or compensation on a case-by-case basis.
      </p>
    </div>

    <label class="consent-check">
      <input type="checkbox" id="media_consent" required>
      <span>
        ฉันได้อ่านและยินยอมตามเงื่อนไขการใช้ข้อมูลและการบันทึกภาพ/วิดีโอข้างต้น<br>
        I have read and agree to the above personal data and media conditions. *
      </span>
    </label>
  </div>
</div>

      <button class="btn primary" type="submit" id="submit-btn">
        ส่งแบบฟอร์ม • Submit
      </button>

    </form>
  </section>

  <!-- THANK YOU SCREEN -->
  <section id="screen-thank" class="hidden">
    <div class="thankfull">
      <h2>THANK YOU!</h2>
      <p>Your media registration has been submitted successfully.<br>ขอบคุณสำหรับการลงทะเบียนสื่อมวลชน</p>
      <button class="btn primary" onclick="showForm()">กลับหน้าหลัก • Back to Home page</button>
    </div>
  </section>

  <div class="footer">© 2025 WGP#1 • Media Registration</div>

<script>
function showForm(){
  document.getElementById("screen-form").classList.remove("hidden");
  document.getElementById("screen-thank").classList.add("hidden");
  document.getElementById("media-form").reset();
  mediaUploadState={path:null,url:null};
}

/* UPLOAD MEDIA PROOF */
document.getElementById("media_file").addEventListener("change", async function(){
  const file = this.files[0];
  if(!file) return;

  const status = document.getElementById("upload_status");
  status.textContent = "Uploading...";
  status.style.color = "#000";

  const clean = file.name.replace(/[^a-zA-Z0-9.-]/g,"_");
  const path = "media-proof/" + Date.now()+"-"+clean;

  const {data, error} = await sb.storage.from("vip_media_proofs")
    .upload(path, file);

  if(error){
    status.textContent = "Upload failed, try again.";
    status.style.color = "red";
    return;
  }

  const { data:publicData } = sb.storage.from("vip_media_proofs").getPublicUrl(path);

  mediaUploadState = {
    path: path,
    url: publicData.publicUrl
  };

  document.getElementById("media_url").value = publicData.publicUrl;
  status.textContent = "Uploaded ✓";
  status.style.color = "green";
});

/* SUBMIT FORM */
document.getElementById("media-form").addEventListener("submit", async function(e){
  e.preventDefault();

  if(!mediaUploadState.url){
    alert("กรุณาอัปโหลด Media ID ก่อนส่งแบบฟอร์ม");
    return;
  }

  const payload = {
    submitted_at: new Date().toISOString(),
    first_name: document.getElementById("first_name").value.trim(),
    last_name: document.getElementById("last_name").value.trim(),
    phone: document.getElementById("phone").value.trim(),
    email: document.getElementById("email").value.trim(),
    media_company: document.getElementById("media_company").value.trim(),
    media_proof_url: mediaUploadState.url,
    media_consent: document.getElementById("media_consent").checked
  };

  const { error } = await sb.from("media_registrations").insert([payload]);

  if(error){
    alert("เกิดข้อผิดพลาด: " + error.message);
    return;
  }

  document.getElementById("screen-form").classList.add("hidden");
  document.getElementById("screen-thank").classList.remove("hidden");
});
</script>

</body>
</html>
