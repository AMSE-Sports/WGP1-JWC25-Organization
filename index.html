<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>VIP Event Participate Form for Organization</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- Supabase JS v2 (UMD) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.48.0/dist/umd/supabase.js"></script>

  <style>
    :root {
      --primary: #f37021;
      --border: #e5e5e5;
      --bg: #fafafa;
      --ok: #16a34a;
      --danger: #dc2626;
    }
    * { box-sizing:border-box; }
    body {
      margin:0;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Arial,sans-serif;
      background: var(--bg);
      color:#111;
    }
    .header { background:#000; }
    .header img { display:block;width:100%;height:auto; }

    .container { max-width: 960px; margin: 0 auto; padding: 16px; }

    .card {
      background:#fff;
      border-radius:16px;
      border:1px solid var(--border);
      box-shadow:0 10px 24px -18px rgba(0,0,0,.35);
      overflow:hidden;
      margin:16px 0;
    }
    .card-head {
      padding:16px 20px;
      border-bottom:1px solid var(--border);
    }
    .card-head h1, .card-head h2 {
      margin:0;
    }
    .card-body { padding:16px 20px 20px; }

    .row {
      display:grid;
      grid-template-columns:1fr;
      gap:12px;
      margin-bottom:12px;
    }
    @media (min-width:760px){
      .row.two { grid-template-columns:1fr 1fr; }
      .row.three { grid-template-columns:1fr 1fr 1fr; }
    }

    label.title {
      font-size:13px;
      font-weight:700;
      display:block;
      margin-bottom:4px;
    }
    label .en {
      font-weight:500;
      color:#555;
      margin-left:4px;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="number"],
    select,
    textarea {
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      outline:none;
      font-size:14px;
      background:#fff;
    }
    textarea { min-height:80px; resize:vertical; }
    input:focus, select:focus, textarea:focus {
      border-color:var(--primary);
      box-shadow:0 0 0 3px rgba(243,112,33,.2);
    }

    .note { font-size:12px;color:#666; }

    .btn {
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border:0;
      cursor:pointer;
      border-radius:16px;
      padding:14px 20px;
      font-weight:800;
      font-size:15px;
    }
    .btn-primary {
      background:var(--primary);
      color:#fff;
      box-shadow:0 10px 24px -16px rgba(243,112,33,.8);
    }
    .btn-primary:disabled { opacity:.6; cursor:default; }
    .btn-outline {
      background:#fff;
      color:#111;
      border:2px solid #111;
    }
    .btn-wide { width:100%; }

    .checkbox-line {
      display:flex;
      flex-wrap:wrap;
      gap:8px 18px;
      font-size:14px;
    }
    .checkbox-line label {
      display:inline-flex;
      align-items:center;
      gap:6px;
    }

    input[type="checkbox"], input[type="radio"]{
      width:auto;
      height:auto;
    }

    .consent-block { font-size:14px; line-height:1.6; margin-bottom:8px; }
    .consent-line {
      display:flex;
      align-items:center;
      gap:8px;
      font-size:14px;
      margin-top:8px;
    }

    .status {
      margin:12px 0 0;
      font-size:14px;
    }
    .status.ok { color:var(--ok); }
    .status.err { color:var(--danger); }

    .screen { display:none; }
    .screen.active { display:block; }

    .thank-screen {
      min-height:40vh;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      text-align:center;
      padding:40px 20px;
      background:linear-gradient(135deg,var(--primary),#ff8c4a);
      color:#fff;
    }
    .thank-screen h2 {
      font-size:34px;
      margin:0 0 10px;
      font-weight:900;
      text-shadow:0 4px 16px rgba(0,0,0,.25);
    }
    .thank-screen p {
      max-width:600px;
      font-size:18px;
      line-height:1.6;
      margin:0;
      text-shadow:0 2px 8px rgba(0,0,0,.2);
    }

    .footer {
      text-align:center;
      padding:16px;
      font-size:12px;
      color:#777;
    }
  </style>
</head>
<body>

  <!-- Header รูปงาน -->
  <div class="header">
    <img src="Header.png" alt="THAI AIRWAYS INTERNATIONAL WGP#1 WATERJET WORLD CUP 2025">
  </div>

  <div class="container">

    <!-- SCREEN 1: FORM -->
    <section id="screen-form" class="screen active">
      <div class="card">
        <div class="card-head">
          <h1>Event Participate Form for Organization</h1>
          <p class="note">สำหรับหน่วยงาน / องค์กร / สปอนเซอร์ / ผู้แทน VIP</p>
        </div>

        <form id="vip-form" class="card-body">
          <!-- A. Organization -->
          <h2>ส่วน A — ข้อมูลหน่วยงาน / Organization Info</h2>
          <div class="row">
            <div>
              <label class="title">ประเภทหน่วยงาน <span class="en">/ Organization Type</span> *</label>
              <select id="org_type" required>
                <option value="">— เลือกประเภท / Select —</option>
                <option value="government">ภาครัฐ / Government</option>
                <option value="private_company">ภาคเอกชน / Private Company</option>
                <option value="sports_association">สมาคมกีฬา / Sports Association</option>
                <option value="media">สื่อมวลชน / Media</option>
                <option value="sponsor">สปอนเซอร์ / Sponsor</option>
                <option value="international_org">องค์กรระหว่างประเทศ / International Organization</option>
                <option value="other">อื่น ๆ / Other</option>
              </select>
            </div>
          </div>

          <div class="row two">
            <div>
              <label class="title">ชื่อหน่วยงาน (TH) <span class="en">/ Organization Name (TH)</span> *</label>
              <input type="text" id="org_name_th" required>
            </div>
            <div>
              <label class="title">ชื่อหน่วยงาน (EN) <span class="en">/ Organization Name (EN)</span></label>
              <input type="text" id="org_name_en">
            </div>
          </div>

          <div class="row two">
            <div>
              <label class="title">ประเทศ <span class="en">/ Country</span> *</label>
              <input type="text" id="org_country" required placeholder="เช่น Thailand / Japan / France">
            </div>
            <div>
              <label class="title">เมือง <span class="en">/ City</span> *</label>
              <input type="text" id="org_city" required placeholder="เช่น Bangkok / Tokyo">
            </div>
          </div>

          <hr>

          <!-- B. Primary VIP -->
          <h2>ส่วน B — ข้อมูลแขก VIP หลัก / Primary VIP Guest</h2>

          <div class="row two">
            <div>
              <label class="title">คำนำหน้า <span class="en">/ Title</span> *</label>
              <select id="vip_title" required>
                <option value="">— เลือกคำนำหน้า / Select —</option>
                <option>Mr.</option>
                <option>Ms.</option>
                <option>Mrs.</option>
                <option>Dr.</option>
                <option>Prof.</option>
                <option>H.E.</option>
                <option>คุณ</option>
                <option>ดร.</option>
                <option>ศ.ดร.</option>
              </select>
            </div>
            <div>
              <label class="title">ชื่อ–นามสกุล (TH) <span class="en">/ Full Name (TH)</span> *</label>
              <input type="text" id="vip_fullname_th" required>
            </div>
          </div>

          <div class="row">
            <div>
              <label class="title">ชื่อ–นามสกุล (EN) <span class="en">/ Full Name (EN)</span></label>
              <input type="text" id="vip_fullname_en">
            </div>
          </div>

          <div class="row two">
            <div>
              <label class="title">ตำแหน่ง <span class="en">/ Position or Role</span> *</label>
              <input type="text" id="vip_position" required placeholder="เช่น President, CEO, Director of Sport">
            </div>
            <div>
              <label class="title">ฝ่าย / แผนก <span class="en">/ Department</span></label>
              <input type="text" id="vip_department" placeholder="เช่น Protocol Division, Marketing Dept.">
            </div>
          </div>

          <hr>

          <!-- C. Contact -->
          <h2>ส่วน C — ข้อมูลติดต่อ / Contact Info</h2>

          <div class="row two">
            <div>
              <label class="title">อีเมลหลักสำหรับติดต่อ <span class="en">/ Primary Email</span> *</label>
              <input type="email" id="contact_email" required>
            </div>
            <div>
              <label class="title">เบอร์โทร / WhatsApp <span class="en">/ Mobile</span> *</label>
              <input type="tel" id="contact_phone" required>
            </div>
          </div>

          <div class="row">
            <div>
              <label class="title">ชื่อผู้ประสานงาน (ถ้าคนละคนกับ VIP) <span class="en">/ Contact Person</span></label>
            </div>
          </div>

          <div class="row two">
            <div>
              <label class="title">ชื่อ–นามสกุลผู้ประสานงาน <span class="en">/ Contact Person Name</span></label>
              <input type="text" id="contact_person_name">
            </div>
            <div>
              <label class="title">ตำแหน่ง <span class="en">/ Position</span></label>
              <input type="text" id="contact_person_position">
            </div>
          </div>

          <div class="row">
            <div>
              <label class="title">เบอร์ผู้ประสานงาน <span class="en">/ Contact Person Phone</span></label>
              <input type="tel" id="contact_person_phone">
            </div>
          </div>

          <hr>

          <!-- D. Accompanying -->
          <h2>ส่วน D — ผู้ติดตาม / Accompanying Guests</h2>

          <div class="row">
            <div>
              <label class="title">จำนวนผู้ติดตาม <span class="en">/ Number of Accompanying Guests</span> *</label>
              <select id="accompany_count" required>
                <option value="">— เลือกจำนวน / Select —</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4+</option>
              </select>
            </div>
          </div>

          <div class="row two">
            <div>
              <label class="title">ผู้ติดตาม 1 — ชื่อ–นามสกุล <span class="en">/ Accompany 1 Name</span></label>
              <input type="text" id="accompany_1_name">
            </div>
            <div>
              <label class="title">บทบาท / ความสัมพันธ์ <span class="en">/ Role or Relation</span></label>
              <input type="text" id="accompany_1_role">
            </div>
          </div>

          <div class="row two">
            <div>
              <label class="title">ผู้ติดตาม 2 — ชื่อ–นามสกุล</label>
              <input type="text" id="accompany_2_name">
            </div>
            <div>
              <label class="title">บทบาท / ความสัมพันธ์</label>
              <input type="text" id="accompany_2_role">
            </div>
          </div>

          <div class="row two">
            <div>
              <label class="title">ผู้ติดตาม 3 — ชื่อ–นามสกุล</label>
              <input type="text" id="accompany_3_name">
            </div>
            <div>
              <label class="title">บทบาท / ความสัมพันธ์</label>
              <input type="text" id="accompany_3_role">
            </div>
          </div>

          <div class="row two">
            <div>
              <label class="title">ผู้ติดตาม 4 — ชื่อ–นามสกุล</label>
              <input type="text" id="accompany_4_name">
            </div>
            <div>
              <label class="title">บทบาท / ความสัมพันธ์</label>
              <input type="text" id="accompany_4_role">
            </div>
          </div>

          <hr>

          <!-- E. Attendance -->
          <h2>ส่วน E — วันที่จะเข้าร่วมงาน / Attendance</h2>
          <div class="row">
            <div class="checkbox-line">
              <label><input type="checkbox" class="attend-day" value="Wed 17 Dec"> Wed 17 Dec</label>
              <label><input type="checkbox" class="attend-day" value="Thu 18 Dec"> Thu 18 Dec</label>
              <label><input type="checkbox" class="attend-day" value="Fri 19 Dec"> Fri 19 Dec</label>
              <label><input type="checkbox" class="attend-day" value="Sat 20 Dec"> Sat 20 Dec</label>
              <label><input type="checkbox" class="attend-day" value="Sun 21 Dec"> Sun 21 Dec</label>
            </div>
            <p class="note">กรุณาเลือกวันโดยประมาณที่คาดว่าจะเข้าร่วม เพื่อช่วยในการจัดที่นั่งและการต้อนรับ</p>
          </div>

          <hr>

          <!-- F. PDPA & Media Consent -->
          <h2>ส่วน F — PDPA & Media Consent</h2>

          <div class="row">
            <div>
              <label class="title">การยินยอมให้ใช้ข้อมูลส่วนบุคคล <span class="en">/ PDPA Consent</span> *</label>
              <div class="consent-block">
                ข้อมูลที่กรอกในแบบฟอร์มนี้จะถูกใช้เพื่อการจัดการงาน การประสานงาน การจัดที่นั่ง
                และการติดต่อเกี่ยวกับงาน WGP#1 Waterjet World Cup 2025 เท่านั้น
                ข้อมูลจะถูกเก็บรักษาอย่างเหมาะสมตามหลักการคุ้มครองข้อมูลส่วนบุคคล
              </div>
              <label class="consent-line">
                <input type="checkbox" id="pdpa_consent" required>
                <span>ฉันได้อ่านและยินยอมให้จัดเก็บและใช้ข้อมูลส่วนบุคคลตามที่ระบุไว้ข้างต้น</span>
              </label>
            </div>
          </div>

          <div class="row">
            <div>
              <label class="title">การยินยอมด้านภาพและสื่อ <span class="en">/ Media Consent</span> *</label>
              <div class="consent-block">
                <strong>EN:</strong> By attending the WGP#1 Waterjet World Cup 2025, which includes live broadcasting and global media coverage, you grant the event organizers and their partners the right to photograph, film, and record your image and voice for use in promotions, advertising, live streams, and other media—without the need for further consent or compensation. Entering the event area constitutes full and unconditional consent. If you do not wish to appear in such media, please avoid camera zones or broadcast areas.
                <br><br>
                <strong>TH:</strong> ในการเข้าชมการแข่งขัน WGP#1 Waterjet World Cup 2025 ซึ่งมีการถ่ายทอดสดและเผยแพร่สู่สาธารณะทั่วโลก ท่านยินยอมให้ผู้จัดงานและพันธมิตร สามารถบันทึกภาพนิ่ง วิดีโอ และเสียงของท่าน เพื่อใช้ในสื่อประชาสัมพันธ์ โฆษณา ถ่ายทอดสด และสื่ออื่น ๆ โดยไม่ต้องขออนุญาตหรือจ่ายค่าตอบแทนใด ๆ เพิ่มเติม การเข้าสู่พื้นที่จัดงาน ถือเป็นการให้ความยินยอมโดยสมบูรณ์ หากไม่ประสงค์ให้ถูกบันทึกภาพ โปรดหลีกเลี่ยงบริเวณกล้องหรือพื้นที่ถ่ายทอดสด
              </div>
              <label class="consent-line">
                <input type="checkbox" id="media_consent" required>
                <span>ฉันได้อ่านและยินยอมตามเงื่อนไขเกี่ยวกับการบันทึกภาพและสื่อข้างต้น</span>
              </label>
            </div>
          </div>

          <hr>

          <!-- G. Media Proof Upload -->
          <h2>ส่วน G — Media Proof (เฉพาะกรณีสื่อมวลชน / Media)</h2>
          <div class="row">
            <div>
              <label class="title">อัปโหลดรูปบัตรสื่อ / หน้าจอเพจ <span class="en">/ Upload Media Proof Image</span></label>
              <input type="file" id="media_proof_file" accept="image/*">
              <p class="note">ใช้กล้องจาก iPad/มือถือถ่าย แล้วอัปโหลดได้โดยตรง (รองรับไฟล์ภาพ เช่น JPG, PNG)</p>
            </div>
          </div>

          <div id="status" class="status"></div>

          <div style="margin-top:16px;">
            <button type="submit" id="submitBtn" class="btn btn-primary btn-wide">
              ส่งแบบฟอร์ม • Submit VIP Registration
            </button>
          </div>
        </form>
      </div>
    </section>

    <!-- SCREEN 2: COMPLETE -->
    <section id="screen-complete" class="screen">
      <div class="card">
        <div class="thank-screen">
          <h2>THANK YOU!</h2>
          <p>
            ขอบคุณสำหรับการลงทะเบียน VIP Event Participate Form for Organization<br>
            ทีมงานจะใช้ข้อมูลนี้เพื่อจัดการเรื่องที่นั่ง การต้อนรับ และพิธีการให้เหมาะสมที่สุด
          </p>
        </div>
        <div class="card-body" style="text-align:center;">
          <button id="backBtn" class="btn btn-outline">
            กลับไปกรอกแบบฟอร์มใหม่ • Back to New Entry
          </button>
        </div>
      </div>
    </section>

    <div class="footer">
      © 2025 WGP#1 Waterjet World Cup — VIP Event Registration System
    </div>
  </div>

  <script>
    // === Supabase config ===
    const SUPABASE_URL = 'https://mhecpnqwwxspxfhdvzsc.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZWNwbnF3d3hzcHhmaGR2enNjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwMDc0MjEsImV4cCI6MjA3ODU4MzQyMX0.ONaEMqU6BHuMSywE3Yvtbj78NqBbecI18amsD18Cgnc';
    const supa = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const screenForm = document.getElementById('screen-form');
    const screenComplete = document.getElementById('screen-complete');
    const form = document.getElementById('vip-form');
    const statusEl = document.getElementById('status');
    const submitBtn = document.getElementById('submitBtn');
    const backBtn = document.getElementById('backBtn');

    function showScreen(name){
      screenForm.classList.remove('active');
      screenComplete.classList.remove('active');
      if(name === 'form') screenForm.classList.add('active');
      if(name === 'complete') screenComplete.classList.add('active');
      window.scrollTo({top:0,behavior:'smooth'});
    }

    backBtn.addEventListener('click', () => {
      form.reset();
      statusEl.textContent = '';
      statusEl.className = 'status';
      showScreen('form');
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusEl.textContent = '';
      statusEl.className = 'status';

      submitBtn.disabled = true;
      submitBtn.textContent = 'กำลังส่งข้อมูล... / Submitting...';

      try {
        // 1) เก็บค่าจากฟอร์ม
        const attendChecks = Array.from(document.querySelectorAll('.attend-day:checked'))
          .map(cb => cb.value);
        const attend_days = attendChecks.join(', ');

        let media_proof_url = null;
        const fileInput = document.getElementById('media_proof_file');
        const file = fileInput.files[0];

        // 2) ถ้ามีไฟล์ ให้ upload ไป Storage ก่อน
        if (file) {
          const filePath = `${Date.now()}_${file.name.replace(/\s+/g,'_')}`;
          const { data: uploadData, error: uploadError } = await supa
            .storage
            .from('vip_media_proofs')
            .upload(filePath, file, { cacheControl: '3600', upsert: false });

          if (uploadError) {
            console.error(uploadError);
            throw new Error('อัปโหลดรูป Media Proof ไม่สำเร็จ');
          }

          const { data: publicUrlData } = supa
            .storage
            .from('vip_media_proofs')
            .getPublicUrl(uploadData.path);

          media_proof_url = publicUrlData.publicUrl;
        }

        // 3) เตรียม row สำหรับ insert
        const row = {
          org_type: document.getElementById('org_type').value || null,
          org_name_th: document.getElementById('org_name_th').value || null,
          org_name_en: document.getElementById('org_name_en').value || null,
          org_country: document.getElementById('org_country').value || null,
          org_city: document.getElementById('org_city').value || null,

          vip_title: document.getElementById('vip_title').value || null,
          vip_fullname_th: document.getElementById('vip_fullname_th').value || null,
          vip_fullname_en: document.getElementById('vip_fullname_en').value || null,
          vip_position: document.getElementById('vip_position').value || null,
          vip_department: document.getElementById('vip_department').value || null,

          contact_email: document.getElementById('contact_email').value || null,
          contact_phone: document.getElementById('contact_phone').value || null,
          contact_person_name: document.getElementById('contact_person_name').value || null,
          contact_person_position: document.getElementById('contact_person_position').value || null,
          contact_person_phone: document.getElementById('contact_person_phone').value || null,

          accompany_count: document.getElementById('accompany_count').value || '0',
          accompany_1_name: document.getElementById('accompany_1_name').value || null,
          accompany_1_role: document.getElementById('accompany_1_role').value || null,
          accompany_2_name: document.getElementById('accompany_2_name').value || null,
          accompany_2_role: document.getElementById('accompany_2_role').value || null,
          accompany_3_name: document.getElementById('accompany_3_name').value || null,
          accompany_3_role: document.getElementById('accompany_3_role').value || null,
          accompany_4_name: document.getElementById('accompany_4_name').value || null,
          accompany_4_role: document.getElementById('accompany_4_role').value || null,

          attend_days: attend_days || null,
          pdpa_consent: document.getElementById('pdpa_consent').checked,
          media_consent: document.getElementById('media_consent').checked,
          media_proof_url: media_proof_url
        };

        // 4) Insert Supabase
        const { error: insertError } = await supa
          .from('vip_event_participants')
          .insert([row]);

        if (insertError) {
          console.error(insertError);
          throw new Error('บันทึกข้อมูลลงฐานข้อมูลไม่สำเร็จ');
        }

        statusEl.textContent = 'บันทึกข้อมูลสำเร็จ';
        statusEl.className = 'status ok';

        // 5) แสดงหน้า Complete
        showScreen('complete');

      } catch (err) {
        console.error(err);
        statusEl.textContent = err.message || 'เกิดข้อผิดพลาดในการส่งแบบฟอร์ม';
        statusEl.className = 'status err';
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'ส่งแบบฟอร์ม • Submit VIP Registration';
      }
    });
  </script>
</body>
</html>
